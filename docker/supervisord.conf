[supervisord]
nodaemon=true
user=qudata
logfile=/app/logs/supervisord.log
pidfile=/tmp/supervisord.pid
childlogdir=/app/logs

[unix_http_server]
file=/tmp/supervisor.sock
chmod=0700
chown=qudata:qudata

[supervisorctl]
serverurl=unix:///tmp/supervisor.sock

[rpcinterface:supervisor]
supervisor.rpcinterface_factory = supervisor.rpcinterface:make_main_rpcinterface

# QuData API Server
[program:qudata-api]
command=gunicorn qudata.api.rest_server:app --bind 0.0.0.0:8000 --workers %(ENV_WORKERS)s --worker-class uvicorn.workers.UvicornWorker
directory=/app
user=qudata
autostart=true
autorestart=true
redirect_stderr=true
stdout_logfile=/app/logs/api.log
stdout_logfile_maxbytes=50MB
stdout_logfile_backups=5
environment=PYTHONPATH="/app"

# QuData Worker
[program:qudata-worker]
command=celery -A qudata.orchestrate.celery_app worker --loglevel=info --concurrency=%(ENV_CELERY_CONCURRENCY)s
directory=/app
user=qudata
autostart=true
autorestart=true
redirect_stderr=true
stdout_logfile=/app/logs/worker.log
stdout_logfile_maxbytes=50MB
stdout_logfile_backups=5
environment=PYTHONPATH="/app"

# QuData Scheduler (optional)
[program:qudata-scheduler]
command=celery -A qudata.orchestrate.celery_app beat --loglevel=info
directory=/app
user=qudata
autostart=false
autorestart=true
redirect_stderr=true
stdout_logfile=/app/logs/scheduler.log
stdout_logfile_maxbytes=50MB
stdout_logfile_backups=5
environment=PYTHONPATH="/app"

# QuData Dashboard (optional)
[program:qudata-dashboard]
command=streamlit run qudata/visualize/dashboard.py --server.port 8001 --server.address 0.0.0.0 --server.headless true
directory=/app
user=qudata
autostart=false
autorestart=true
redirect_stderr=true
stdout_logfile=/app/logs/dashboard.log
stdout_logfile_maxbytes=50MB
stdout_logfile_backups=5
environment=PYTHONPATH="/app"

# QuData Monitoring (optional)
[program:qudata-monitoring]
command=python -m qudata.visualize.metrics --host 0.0.0.0 --port 8080
directory=/app
user=qudata
autostart=false
autorestart=true
redirect_stderr=true
stdout_logfile=/app/logs/monitoring.log
stdout_logfile_maxbytes=50MB
stdout_logfile_backups=5
environment=PYTHONPATH="/app"